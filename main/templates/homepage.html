<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://unpkg.com/htmx.org@1.9.12" integrity="sha384-ujb1lZYygJmzgSwoxRggbCHcjc0rB2XoQrxeTUQyRjrOnlCoYta87iKBWq3EsdM2" crossorigin="anonymous"></script>
    <link href='https://fonts.googleapis.com/css?family=Milonga' rel='stylesheet'>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="{{ url_for('static', filename='js/izbornik.js' ) }}" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>

<body>
    <div class="grid-container">
        <div class="logo">
            <img src="{{ url_for('static', filename='images/Logo.png') }}" alt="Slika Loga">
        </div>
        {% if session['logged_in'] %}
        <div class="icons">
            <form action="/logout" method="POST">
                <button type="submit" class="button_tool">Logout</button>
            </form>
            <a href="/mail"><img src="{{ url_for('static', filename = 'images/mail-outline.svg') }}" alt="Icon 1"></a>
            <a href="/profile"><img src="{{ url_for('static', filename = 'images/profilna.svg') }}" alt="Icon 2"></a>
        </div>
        {% else %}
        <div class="icons">
            <form action="/register">
                <button class="button_tool">Register</button>
            </form>
            <form action="/login">
                <button class="button_tool">Log in</button>
            </form>
        </div>
        {% endif %}
        <div class="date-time-container">
            <form id="datetime-form" action="/" method="get">
                <label for="datum"  style="color: #00008B ; font-family: 'Milonga', cursive;  display: inline-block;">Date:</label>
                <input type="date" name="date" id="date"><br>
                <label for="vrijeme"  style="color: #00008B ; font-family: 'Milonga', cursive; display: inline-block;">Time:</label>
                <input  type="time" name="time" id="time">
            </form>
        </div>
        <div class="izbornik">
            <button class="prevButton" hx-get="/prev" method="post">&lt; </button>
            <span class="option-label" id="prostorijaLabel" style="color: black; font-family: 'Milonga', cursive;">{{ prev_prostorija }}</span>
            <button class="nextButton" hx-get="/next" method="post"> &gt;</button>
        </div>
        <div class="table-background">
            <div class="table-container">
                <div class="table-reservation">
                    <div class="table">
                        <div class="tooltip">
                            <span class="tooltip-text">Reserve this table?</span>
                            <button class="reserve-button" hx-post="/reserve" hx-target="#reservation-status">Reserve</button>
                        </div>
                    </div>
                    <div class="table"></div>
                    <div class="table"></div>
                    <div class="table"></div>
                    <div class="table"></div>
                    <div class="table"></div>
                    <div class="table"></div>
                    <div class="table"></div>
                    <div class="table"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Submit the form when date or time input fields change
        document.getElementById("date").addEventListener("change", function() {
            document.getElementById("datetime-form").submit();
        });

        document.getElementById("time").addEventListener("change", function() {
            document.getElementById("datetime-form").submit();
        });
            // Function to get URL parameters
    // Function to get URL parameters

    function getUrlParameter(name) {
            name = name.replace(/[[]/, '\\[').replace(/[\]]/, '\\]');
            var regex = new RegExp('[\\?&]' + name + '=([^&#]*)');
            var results = regex.exec(location.search);
            return results === null ? '' : decodeURIComponent(results[1].replace(/\+/g, ' '));
        };
    
        // Get the current date and time
        var currentDate = new Date();
        var currentHour = currentDate.getHours()+1;
        var currentMinute = currentDate.getMinutes();
    
        // Get the date and time parameters from the URL
        var dateParam = getUrlParameter('date');
        var timeParam = getUrlParameter('time');
    
        // Calculate the default date (today's date) if date parameter is not present
        if (!dateParam) {
            var year = currentDate.getFullYear();
            var month = ('0' + (currentDate.getMonth() + 1)).slice(-2); // Add 1 to month because January is 0
            var day = ('0' + currentDate.getDate()).slice(-2);
            var defaultDate = year + '-' + month + '-' + day;
        }
    
        // Set the default time (next full hour) if time parameter is not present
        var defaultHour;
        if (!timeParam) {
            if (currentMinute >= 30) {
                defaultHour = ('0' + (currentHour + 1)).slice(-2);
            } else {
                defaultHour = ('0' + currentHour).slice(-2);
            }
            var defaultTime = defaultHour + ':00'; 
        }
    
        // Set the values of the date and time input fields
        document.getElementById("date").value = dateParam || defaultDate;
        document.getElementById("time").value = timeParam || defaultTime;
    
        // Generate time options with 30-minute intervals
        var timeSelect = document.getElementById("time");
        for (var hour = 0; hour < 24; hour++) {
            for (var minute = 0; minute < 60; minute += 30) {
                if (minute === 0 || minute === 30) {
                    var option = document.createElement("option");
                    var timeString = ("0" + hour).slice(-2) + ":" + ("0" + minute).slice(-2);
                    option.text = timeString;
                    option.value = timeString;
                    timeSelect.add(option);
                }
            }
        }
    
        // Submit the form when date or time input fields change
        document.getElementById("date").addEventListener("change", function() {
            document.getElementById("datetime-form").submit();
        });
    
        document.getElementById("time").addEventListener("change", function() {
            document.getElementById("datetime-form").submit();
        });
    </script>
</body>
</html>
